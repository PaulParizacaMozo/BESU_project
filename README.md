# eVTOL Travel Prototype on Hyperledger Besu

This repository extends the **Quorum Dev Quickstart** Besu network with a set of smart contracts and scripts that model a simple eVTOL travel scenario: user authorization, vertiport capacity, eVTOL lifecycle, and flight reservations.

The goal is **not** to provide a production setup, but a compact environment to:

- Spin up a local Besu IBFT2 network with Docker.
- Deploy a small suite of domain smart contracts.
- Run a single end-to-end smoke test that executes a full trip on-chain.

---

## Table of Contents

- [Architecture](#architecture)
- [Prerequisites](#prerequisites)
- [Getting Started](#getting-started)
  - [1. Start the Besu Dev Network](#1-start-the-besu-dev-network)
  - [2. Deploy the Smart Contracts](#2-deploy-the-smart-contracts)
  - [3. Run the End-to-End Smoke Test](#3-run-the-end-to-end-smoke-test)
- [Repository Layout](#repository-layout)
- [What the Prototype Does](#what-the-prototype-does)
- [Next Steps](#next-steps)

---

## Architecture

The project uses the Besu-based Quorum Dev Quickstart network: 4 validator nodes, 1 RPC node, and optional monitoring tools (Prometheus, Grafana, block explorer).

The logical view of the blockchain network is shown in the original quickstart diagram:

![Blockchain network](./static/blockchain-network.png)

On top of this network, the prototype deploys four smart contracts:

- `UserVerification` – stores which users are allowed to fly.
- `VertiportManagement` – models vertiport capacity (runways and parking).
- `EVTOLManagement` – tracks eVTOL state and current vertiport.
- `FlightReservation` – orchestrates reservations and the full trip lifecycle.

A single Node.js smoke test script (`smoke_test_full_system.js`) interacts with the RPC node and drives the full flow of a “simple trip” between two vertiports.

---

## Prerequisites

You need:

- [Docker and Docker Compose](https://docs.docker.com/compose/install/) v2+
- [Node.js](https://nodejs.org/) (LTS recommended) and `npm`
- Git Bash or a Unix-like shell (if you are on Windows)

> Make sure Docker has at least **4 GB of RAM** allocated (more if you also enable privacy/extra services later).

---

## Getting Started

### 1. Start the Besu Dev Network

From the quickstart network folder (generated by the Quorum Dev Quickstart scripts):

```bash
cd quorum-test-network
./run.sh
````

This will start:

- 4 Besu validator nodes
- 1 Besu RPC node (`rpcnode`)
- A block explorer (default port from the quickstart)
- Optional monitoring tools (Prometheus, Grafana) if enabled during setup

You can confirm the RPC node is running and connected to its peers in the “Nodes” view of the explorer UI.

To stop or clean up the network:

```bash
./stop.sh      # stop all containers (can be resumed)
./resume.sh    # resume a stopped network
./remove.sh    # stop and remove all containers and images
```

### 2. Deploy the Smart Contracts

The eVTOL prototype contracts live in the `smart_contracts` directory.

```bash
cd smart_contracts
npm install
node scripts/deploy_system.js
```

The deployment script:

- Connects to the Besu RPC node.
- Estimates gas for each contract.
- Deploys, in order:

  - `UserVerification`
  - `VertiportManagement`
  - `EVTOLManagement`
  - `FlightReservation`
- Prints a summary with the deployed addresses.

You can cross-check these deployments in the block explorer: you should see four `Contract Creation` transactions with status `Success`.

> Full source for the deployment script is in **Anexo B** (`deploy_system.js` listing) of the LaTeX report.

### 3. Run the End-to-End Smoke Test

Once the contracts are deployed, run the end-to-end test:

```bash
cd smart_contracts
node scripts/smoke_test_full_system.js
```

The smoke test script:

1. Marks a specific account as “allowed to fly” in `UserVerification`.
2. Registers an origin and destination vertiport in `VertiportManagement`.
3. Registers a single eVTOL in `EVTOLManagement` at the origin vertiport.
4. Creates a reservation in `FlightReservation` (user + origin + destination + eVTOL).
5. Starts the trip (updates reservation and eVTOL state, adjusts origin vertiport capacity).
6. Completes the trip (moves the eVTOL to the destination vertiport, updates capacity, marks the trip as completed).

In the console you should see the steps `[1]` to `[7]` logged with the relevant states before and after each call, ending with:

```text
Smoke test FULL finished OK.
```

In the block explorer, you will see a sequence of `Contract Call` transactions corresponding to each step of the script, all with status `Success`.

> Full source for the smoke test script is in **Anexo C** (`smoke_test_full_system.js` listing) of the LaTeX report.

---

## Repository Layout

High level layout (relevant parts):

```text
quorum-test-network/       # Quorum Dev Quickstart network artifacts
  docker-compose.yml
  run.sh / stop.sh / ...

smart_contracts/           # eVTOL prototype
  contracts/
    UserVerification.sol
    VertiportManagement.sol
    EVTOLManagement.sol
    FlightReservation.sol
  scripts/
    deploy_system.js
    smoke_test_full_system.js
  package.json
```

---

## What the Prototype Does

On top of a standard Besu IBFT2 dev network, the prototype demonstrates:

- **User gating**: only users flagged as `canRide` in `UserVerification` can reserve flights.
- **Vertiport capacity**: `VertiportManagement` enforces simple capacity rules for runways and parking.
- **eVTOL lifecycle**: `EVTOLManagement` keeps each eVTOL in a valid state (PARKED → EXPECTING → IN_USE → PARKED).
- **Trip orchestration**: `FlightReservation` coordinates all three contracts so that a “simple trip” is fully reflected on-chain.

Credentials and SSI are **mocked**: the contracts expose placeholders that assume off-chain verification (Aries/Indy) and only receive the relevant flags or identifiers on-chain.

---

## Next Steps

This dev setup is intentionally minimal. Concrete next steps include:

- Replacing the credential mocks with a real Aries/Indy integration (agents, schemas, revocation, etc.).
- Moving away from Quorum Dev Quickstart to a **custom Besu network** (own genesis, node keys, permissioning).
- Expanding the domain logic (multiple concurrent trips, cancellations, penalties, payments).
- Adding a small API or UI to interact with the contracts without touching scripts directly.

For moving from this prototype to a more production-like environment, refer to the official [Hyperledger Besu documentation](https://besu.hyperledger.org/) for guidance on network design, deployment, and monitoring.
